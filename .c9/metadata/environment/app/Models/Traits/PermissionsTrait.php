{"filter":false,"title":"PermissionsTrait.php","tooltip":"/app/Models/Traits/PermissionsTrait.php","undoManager":{"mark":24,"position":24,"stack":[[{"start":{"row":0,"column":0},"end":{"row":20,"column":1},"action":"insert","lines":["<?php","namespace App\\Permissions;","","use App\\Permission;","use App\\Role;","","trait HasPermissionsTrait {","","   public function roles() {","      return $this->belongsToMany(Role::class,'role_user');","","   }","","","   //public function permissions() {","//      return $this->belongsToMany(Permission::class,'users_permissions');","//","//   }","","","}"],"id":2}],[{"start":{"row":1,"column":14},"end":{"row":1,"column":15},"action":"insert","lines":["M"],"id":3},{"start":{"row":1,"column":15},"end":{"row":1,"column":16},"action":"insert","lines":["o"]}],[{"start":{"row":1,"column":14},"end":{"row":1,"column":16},"action":"remove","lines":["Mo"],"id":4},{"start":{"row":1,"column":14},"end":{"row":1,"column":20},"action":"insert","lines":["Models"]}],[{"start":{"row":1,"column":20},"end":{"row":1,"column":21},"action":"insert","lines":["\\"],"id":5}],[{"start":{"row":1,"column":21},"end":{"row":1,"column":22},"action":"remove","lines":["P"],"id":6},{"start":{"row":1,"column":21},"end":{"row":1,"column":22},"action":"remove","lines":["e"]},{"start":{"row":1,"column":21},"end":{"row":1,"column":22},"action":"remove","lines":["r"]},{"start":{"row":1,"column":21},"end":{"row":1,"column":22},"action":"remove","lines":["m"]},{"start":{"row":1,"column":21},"end":{"row":1,"column":22},"action":"remove","lines":["i"]},{"start":{"row":1,"column":21},"end":{"row":1,"column":22},"action":"remove","lines":["s"]},{"start":{"row":1,"column":21},"end":{"row":1,"column":22},"action":"remove","lines":["s"]},{"start":{"row":1,"column":21},"end":{"row":1,"column":22},"action":"remove","lines":["i"]},{"start":{"row":1,"column":21},"end":{"row":1,"column":22},"action":"remove","lines":["o"]},{"start":{"row":1,"column":21},"end":{"row":1,"column":22},"action":"remove","lines":["n"]}],[{"start":{"row":1,"column":21},"end":{"row":1,"column":22},"action":"remove","lines":["s"],"id":7}],[{"start":{"row":1,"column":21},"end":{"row":1,"column":22},"action":"insert","lines":["T"],"id":8},{"start":{"row":1,"column":22},"end":{"row":1,"column":23},"action":"insert","lines":["r"]},{"start":{"row":1,"column":23},"end":{"row":1,"column":24},"action":"insert","lines":["a"]},{"start":{"row":1,"column":24},"end":{"row":1,"column":25},"action":"insert","lines":["i"]},{"start":{"row":1,"column":25},"end":{"row":1,"column":26},"action":"insert","lines":["t"]}],[{"start":{"row":1,"column":26},"end":{"row":1,"column":27},"action":"insert","lines":["s"],"id":9}],[{"start":{"row":3,"column":8},"end":{"row":3,"column":9},"action":"insert","lines":["M"],"id":10},{"start":{"row":3,"column":9},"end":{"row":3,"column":10},"action":"insert","lines":["o"]},{"start":{"row":3,"column":10},"end":{"row":3,"column":11},"action":"insert","lines":["d"]},{"start":{"row":3,"column":11},"end":{"row":3,"column":12},"action":"insert","lines":["e"]},{"start":{"row":3,"column":12},"end":{"row":3,"column":13},"action":"insert","lines":[";"]}],[{"start":{"row":3,"column":12},"end":{"row":3,"column":13},"action":"remove","lines":[";"],"id":11}],[{"start":{"row":3,"column":12},"end":{"row":3,"column":13},"action":"insert","lines":[";"],"id":12}],[{"start":{"row":3,"column":12},"end":{"row":3,"column":13},"action":"remove","lines":[";"],"id":13}],[{"start":{"row":3,"column":12},"end":{"row":3,"column":13},"action":"insert","lines":[";"],"id":14}],[{"start":{"row":3,"column":12},"end":{"row":3,"column":13},"action":"remove","lines":[";"],"id":15}],[{"start":{"row":3,"column":12},"end":{"row":3,"column":13},"action":"insert","lines":["'"],"id":16}],[{"start":{"row":3,"column":12},"end":{"row":3,"column":13},"action":"remove","lines":["'"],"id":17}],[{"start":{"row":3,"column":12},"end":{"row":3,"column":13},"action":"insert","lines":["m"],"id":18}],[{"start":{"row":3,"column":12},"end":{"row":3,"column":13},"action":"remove","lines":["m"],"id":19}],[{"start":{"row":3,"column":12},"end":{"row":3,"column":13},"action":"insert","lines":["l"],"id":20}],[{"start":{"row":3,"column":13},"end":{"row":3,"column":14},"action":"insert","lines":["s"],"id":21},{"start":{"row":3,"column":14},"end":{"row":3,"column":15},"action":"insert","lines":["\\"]}],[{"start":{"row":4,"column":8},"end":{"row":4,"column":9},"action":"insert","lines":["M"],"id":22},{"start":{"row":4,"column":9},"end":{"row":4,"column":10},"action":"insert","lines":["o"]},{"start":{"row":4,"column":10},"end":{"row":4,"column":11},"action":"insert","lines":["d"]},{"start":{"row":4,"column":11},"end":{"row":4,"column":12},"action":"insert","lines":["e"]},{"start":{"row":4,"column":12},"end":{"row":4,"column":13},"action":"insert","lines":["l"]},{"start":{"row":4,"column":13},"end":{"row":4,"column":14},"action":"insert","lines":["s"]}],[{"start":{"row":4,"column":14},"end":{"row":4,"column":15},"action":"insert","lines":["\\"],"id":23}],[{"start":{"row":6,"column":6},"end":{"row":6,"column":7},"action":"remove","lines":["H"],"id":24},{"start":{"row":6,"column":6},"end":{"row":6,"column":7},"action":"remove","lines":["a"]},{"start":{"row":6,"column":6},"end":{"row":6,"column":7},"action":"remove","lines":["s"]}],[{"start":{"row":8,"column":3},"end":{"row":17,"column":6},"action":"remove","lines":["public function roles() {","      return $this->belongsToMany(Role::class,'role_user');","","   }","","","   //public function permissions() {","//      return $this->belongsToMany(Permission::class,'users_permissions');","//","//   }"],"id":25},{"start":{"row":8,"column":3},"end":{"row":9,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":8,"column":3},"end":{"row":66,"column":5},"action":"insert","lines":["//$require = true - обязательное совпадение всех permission в массиве $permission (если от массив)","    //$require = false - достаточно совпадение хотя бы одного permission в $permission","    public function canDo($permission, $require = false) {","        //Если $permission - это массив:","        if(is_array($permission)) {","            foreach($permission as $permName) {","                $permName = $this->canDo($permName);","                if($permName && !$require) {","                    return true;","                }","                else if(!$permName && $require) {","                    return false;","                }","            }","            //Если на каждой итерации цикла $this->canDo($permName) всегда вернет true","            //т.е. - ги одно из условий выше не будет выполнено","            //и входящее $require == true","            return $require;","            ","        }","        //Если $permission - это строка","        else {","            foreach($this->roles as $role) {","                foreach($role->permissions as $perm) {","                    //Поиск совпадения по маске","                    if(str_is($permission, $perm->name)) {","                        return true;","                    }","                }","            }","        }","    }","    ","    ","    public function hasRole($name, $require = false) {","        //Если $name - это массив:","        if(is_array($name)) {","            foreach($name as $roleName) {","                $hasRole = $this->canDo($roleName);","                if($hasRole && !$require) {","                    return true;","                }","                else if(!$hasRole && $require) {","                    return false;","                }","            }","            return $require;","            ","        }","        //Если $name - это строка","        else {","            foreach($this->roles as $role) {","                if($role->name == $name) {","                    return true;","                }","            }","        }","        return false;","    }"],"id":26}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":1,"column":10},"end":{"row":1,"column":27},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1561763890420,"hash":"f671c7e5f287ce6e96d0877bf817fa622e5f690c"}